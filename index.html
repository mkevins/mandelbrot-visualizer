<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Mandelbrot</title><style type="text/css" media="screen">html{touch-action:none}body{text-align:center;margin:0;overflow:hidden;background-color:#000}.custom-cursor{position:absolute;top:-10000px;left:-10000px}.canvas{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.mandelbrot{cursor:crosshair}.canvas.mandelbrot{width:100%;height:100%;z-index:2}.canvas.mandelbrot-overlay{width:100%;height:100%;z-index:1}.overlay-hidden{opacity:0}</style></head><body><canvas class="canvas mandelbrot-overlay"></canvas><canvas class="canvas mandelbrot"></canvas><!-- SVG custom cursor --> <svg id="svg2" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="16" width="16" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 16 16" class="custom-cursor"><metadata id="metadata7"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1036.4)"><path id="path4138-2" d="m0 1052.4s-0.04943-1.6259 0.99996-2.9999c1.0494-1.3739 5.9997-3.9998 5.9997-3.9998s-2.6259 4.9504-3.9998 5.9998c-1.3739 1-2.9999 1-2.9999 1z"/><path id="use4812-6" d="m0.000002 1036.4s1.626-0.049 2.9999 1c1.3739 1.0494 3.9998 5.9997 3.9998 5.9997s-4.9503-2.6259-5.9997-3.9998-0.99995-2.9999-0.99995-2.9999z"/><path id="use4814-1" d="m15.999 1036.4s0.04943 1.626-0.99995 2.9999-5.9997 3.9998-5.9997 3.9998 2.6259-4.9503 3.9998-5.9997 2.9999-1 2.9999-1z"/><path id="use4816-8" d="m15.999 1052.4s-1.626 0.049-2.9999-0.9999c-1.3739-1.0494-3.9998-5.9998-3.9998-5.9998s4.9503 2.6259 5.9997 3.9998c1.0494 1.374 0.99995 2.9999 0.99995 2.9999z"/></g></svg><script charset="utf-8">const cMagnitude=e=>(e.r**2+e.i**2)**.5,cAdd=(e,t)=>({r:e.r+t.r,i:e.i+t.i}),cMultiply=(e,t)=>({r:e.r*t.r-e.i*t.i,i:e.r*t.i+e.i*t.r}),cSquare=({r:e,i:t})=>({r:e**2-t**2,i:2*e*t}),CYCLE_LENGTH=7e3;let lastColor,isColorPaused=!1,lastPauseTime=Date.now(),pauseLag=0;function colorTime(e){return isColorPaused||(lastColor=calculateColor(e-pauseLag)),lastColor}function calculateColor(e){return"hsl("+e%CYCLE_LENGTH*(360/CYCLE_LENGTH)+", 100%, 50%)"}function toggleColorPause(){let e=Date.now();if(isColorPaused){pauseLag=(pauseLag+(e-lastPauseTime))%CYCLE_LENGTH,isColorPaused=!1}else lastPauseTime=e,isColorPaused=!0}const svg=document.getElementsByTagName("svg")[0];function getCursorUrl(){let e=colorTime(Date.now());return svg.style.fill=e,`url('data:image/svg+xml;utf8,${encodeURIComponent(svg.outerHTML)}') 8 8, auto`}const layers=document.getElementsByClassName("canvas"),overlay=layers[0],canvas=layers[1],context=canvas.getContext("2d");var resizeTimeStamp=0;const ITERATION_COUNT=1e4,DOT_SIZE=.5,SPAN_X=4,SPAN_Y=4,CURSOR_RATE=10;let isOverlayEnabled,zoom=1,width=SPAN_X/zoom,height=SPAN_Y/zoom,center={i:0,r:0},isPaused=!1,isFadeEnabled=!0,isSymmetric=!1,isOverlayDrawn=!1;function togglePause(){isPaused=!isPaused}function toggleFade(){isFadeEnabled=!isFadeEnabled}function toggleSymmetry(){isSymmetric=!isSymmetric}function setOverlay(e){e?(isOverlayDrawn||drawOverlay(),overlay.classList.remove("overlay-hidden"),isOverlayEnabled=!0):(overlay.classList.add("overlay-hidden"),isOverlayEnabled=!1)}function toggleOverlay(){setOverlay(!isOverlayEnabled)}function resize(){canvas.height<canvas.width?(height=SPAN_Y/zoom,width=SPAN_X*canvas.width/canvas.height/zoom):(width=SPAN_X/zoom,height=SPAN_Y*canvas.width/canvas.height/zoom),isOverlayEnabled&&!isOverlayDrawn&&drawOverlay()}function clear(){context.clearRect(0,0,canvas.width,canvas.height)}function f(e,t){return cAdd(cSquare(e),t)}function screenToComplex(e,t){return{i:width*(e/canvas.width-.5)+center.i,r:height*(t/canvas.height-.5)+center.r}}function complexToScreen(e){return{x:((e.i-center.i)/width+.5)*canvas.width,y:((e.r-center.r)/height+.5)*canvas.height}}function iterate(e,t,a,o=ITERATION_COUNT){let n={r:0,i:0},r=screenToComplex(e,t);for(let e=0;e<o;e++){let e=complexToScreen(n=f(n,r));drawCircle(e.x,e.y,DOT_SIZE,a),isSymmetric&&drawCircle((e=complexToScreen({r:n.r,i:-n.i})).x,e.y,DOT_SIZE,a)}}function drawCircle(e,t,a,o){context.fillStyle=o,context.beginPath(),context.arc(e,t,a,0,2*Math.PI),context.fill()}setOverlay(!1),window.addEventListener("resize",e=>{var t=Date.now();t>resizeTimeStamp+16&&(isOverlayDrawn=!1,canvas.width=window.innerWidth,canvas.height=window.innerHeight,overlay.width=window.innerWidth,overlay.height=window.innerHeight,resize(),resizeTimeStamp=t)}),window.dispatchEvent(new Event("resize")),window.addEventListener("keydown",e=>{switch(e.key){case"c":toggleColorPause();break;case"f":toggleFade();break;case"o":toggleOverlay();break;case"p":togglePause();break;case"r":clear();break;case"s":toggleSymmetry();break;case" ":let t=colorTime(Date.now());iterate(mouseX,mouseY,t)}e.key});var alpha=.3,smooth=[0,0],moveTimeStamp=0,mouseX=0,mouseY=0;function handleMove(e,t){var a=Date.now();if(mouseX=event.offsetX,mouseY=event.offsetY,a>moveTimeStamp+16){if(smooth[0]=(1-alpha)*smooth[0]+alpha*e,smooth[1]=(1-alpha)*smooth[1]+alpha*t,!isPaused){isFadeEnabled&&throttledFade(.07);let e=colorTime(a);iterate(...smooth,e)}moveTimeStamp=a}}addEventListener("mousemove",function(e){handleMove(e.offsetX,e.offsetY)}),addEventListener("touchmove",function(e){let{clientX:t,clientY:a}=e.changedTouches[0];handleMove(t,a)}),canvas.addEventListener("wheel",e=>{let t=Date.now();console.log("start"),console.log(Date.now()-t),e.preventDefault(),mouseX=e.offsetX,mouseY=e.offsetY;let a=document.createElement("canvas"),o=a.getContext("2d");a.width=canvas.width,a.height=canvas.height,console.log("after create temp canvas"),console.log(Date.now()-t);let n=context.getImageData(0,0,canvas.width,canvas.height);o.putImageData(n,0,0),console.log("after putImageData"),console.log(Date.now()-t);let r=screenToComplex(mouseX,mouseY),s=cAdd(cMultiply({r:-1,i:0},center),r);e.wheelDelta<0?(zoom*=7/8,s=cMultiply({r:-1/7,i:0},s),center=cAdd(s,center),context.clearRect(0,0,canvas.width,canvas.height),context.save(),context.translate(mouseX,mouseY),context.scale(7/8,7/8),context.drawImage(a,-mouseX,-mouseY),context.restore()):(zoom*=8/7,s=cMultiply({r:1/8,i:0},s),center=cAdd(s,center),context.clearRect(0,0,canvas.width,canvas.height),context.save(),context.translate(mouseX,mouseY),context.scale(8/7,8/7),context.drawImage(a,-mouseX,-mouseY),context.restore()),a.remove(),console.log("after drawImage"),console.log(Date.now()-t),isOverlayDrawn=!1,resize(),console.log("afterResize"),console.log(Date.now()-t)});let fadeCounter=0;function throttledFade(e){5<++fadeCounter&&(fade(e),fadeCounter=0)}function fade(e){context.fillStyle="rgba(0, 0, 0, "+e+")",context.fillRect(0,0,canvas.width,canvas.height);for(var t=context.getImageData(0,0,canvas.width,canvas.height),a=t.data,o=0,n=a.length;o<n;o+=4)a[o]<8&&a[o+1]<8&&a[o+2]<8&&(a[o]=0,a[o+1]=0,a[o+2]=0,a[o+3]=0);context.putImageData(t,0,0)}function drawOverlay(){var e=overlay.getContext("2d");let t=e.createImageData(overlay.width,overlay.height),a=t.data;for(let e=0;e<a.length;e+=4){let t,o=!0,n={r:0,i:0},r=screenToComplex(.5+e/4%overlay.width,.5+Math.floor(e/(4*overlay.width)));for(t=0;t<25;t++)if(n=f(n,r),2<cMagnitude(n)){o=!1;break}!o&&3<t&&(a[e]=100-4*t,a[e+1]=100-4*t,a[e+2]=100-4*t,a[e+3]=127,24==t&&(a[e]=255,a[e+1]=255,a[e+2]=255))}e.putImageData(t,0,0),isOverlayDrawn=!0}setInterval(()=>{canvas.style.cursor=getCursorUrl()},100);</script></body></html>